---
title: 用机器学习玩转FlappyBird
date: 2019-09-06 18:56:12
thumbnail: https://resources.chenjianhui.site/2019-09-06-home-pic.jpg
top: 100
categories: 
- 随笔
tags: 
- Machine Learning
---

两年前刚毕业的时候由于兴趣爱好就接触到了一些机器学习的内容，今天想到写这么一篇文章的主要原因是由于公司安排昨天去接送了一位做数据挖掘方向的教授，在接送途中跟她聊了一些有关数据挖掘与机器学习方面的内容并且从中受益，加上自己的部分兴趣于是就想产出一篇文章来说一下自己对于这块内容的理解，由于专业性的问题其中说法如果有误还请指出。

<!-- more -->

> 本篇博客相关代码托管于**[github](https://github.com/calebman/flappy-learning)**
游戏引擎与AI基于**Vuejs**+**TypeScript**+**Tensorflow.js**实现，**[点此在线预览](https://calebman.github.io/flappy-learning/)**
**[如果这个项目激起了你的兴趣，欢迎分享与Star](https://github.com/calebman/flappy-learning)**

## 概述

本篇文章我将从三个方面去阐述我个人的机器学习经历及理解，也算是我这部分知识的一个成长经历。

1. 初探机器学习：这里主要是描述一下我毕业不久后接触的一个Github仓库[FlappyLearning](https://github.com/xviniette/FlappyLearning)，这个仓库用了一个很形象的例子来描述机器学习的作用，这个例子解决了我的一个疑惑，**机器如何针对一个问题做出决策？**
2. 反向传播与遗传算法：这两个算法很具有代表性，机器决策的核心是一个函数模型，问题的决策和模型的出参与阈值有关，所以机器学习的目的就是构造一个适用于问题的函数以及合适的分类阈值，而构造的过程可以用这两个算法来实现
3. 基于Tensorflow玩转FlappyBird：Tensorflow是谷歌的一个机器学习开源库，能够很方便的构造一个神经网络，现在在js中也有实现版本，学习的途径也很多，这次我将基于Tensorflow来改造FlappyLearning这个仓库，顺便让自己学习Tensorflow的途中不那么枯燥

## 初探机器学习

对于机器学习的概念解释我本人不是解释的很清楚，但是我可以从应用场景方面来分析一下机器学习在什么场景下会适用，机器学习现有的应用场景主要包括各种识别、推荐、广告、客服，这些场景我认为有以下几个**共性**

1. **不容易用统一的逻辑归纳**：比如人脸的特征值比对，我们很难编写统一的逻辑代码来确定怎样的两组特征值才算是比对成功
2. **根据历史数据给出预测**：比如网易云音乐的每日推荐，当你用得越久收藏/喜欢点击的越多，它推荐给和你口味歌曲的占比就越大，但是没有历史数据就会不准确。
3. **都属于分类或聚类问题**：在这里解释一下什么是分类与聚类，并给出相应的例子
  * **分类**：通过学习得到一个目标函数f，把每个属性集x映射到一个预先定义的类标号y中，比如根据人脸特征值来判断此次比对是属于比对成功/失败的哪种类别。
  * **聚类**：事先并不知道任何样本的类别标号，希望通过某种算法来把一组未知类别的样本划分成若干类别，比如广告投放业务中将用户群体分类然后分别投放不同的广告。

接下来我们利用[FlappyLearning](https://github.com/xviniette/FlappyLearning)来了解一下机器是怎么通过自我学习做出决策的，首先我们来介绍一下这个游戏

* Score：当前游戏得分
* Max Score：代表游戏最高得分
* Generation：代表鸟的代数，当50只鸟死完了就会通过遗传算法的优胜劣汰原则经过遗传变异生成新的五十只鸟参加游戏
* Alive：代表当前游戏下鸟的存活量以及总数量
* x1/x2...按钮：代表游戏运行速率，可以调快一点大概经过10-20代机器便能学会此游戏

{% raw %}

<div style=" margin: 0 auto;text-align: center;" >
<iframe style="max-width: 520px;" width="100%"  height="600" src="https://xviniette.github.io/FlappyLearning/"></iframe>
</div>

{% endraw %}

机器如何通过自我学习来通关游戏的，我将从以下两个方面分析一下：

1. 机器是如何来决策游戏走向的？
2. 如何获得一个合适的决策函数？

### 机器是如何来决策游戏走向的

我们上面讲到机器学习大部分可以分为**分类与聚类**两类问题，我们先来了解一下FlappyBird这个游戏的玩法，玩家需要根据小鸟所处的当前位置来控制小鸟的飞行（跳跃），从而使得小鸟不会撞到障碍物。

现在我们来换个更接机器地气的说法，假设每个小鸟都有一个飞行判断函数**y=f(x1,x2...)**，其中x1,x2...都是函数的输入参数，y是函数的输出参数，我们要根据结果y来决策当前环境是否需要跳跃，如果**f(x1,x2...)**这个函数适合于这个问题，那么小鸟就能根据这个函数完美的通关游戏。

如果按照上述方式去理解的话，机器学习的目的是什么就显而易见了，就是为了寻找一个适合于特定场景的决策函数，起到**高准确率的预测**效果，拿FlappyBird这个游戏举例，这个游戏的输入可以是以下很多种并且不限于此

* 一帧图片
* 小鸟距离的障碍物的垂直距离
* 小鸟距离障碍物的水平距离

为什么要专门拿输入这个概念来说？我们来**模拟人类**玩这个游戏，人类通过眼睛来获取小鸟的**位置信息**（其实在关注小鸟和障碍物的相对距离），来决策小鸟**是否需要跳跃**，我们把这个过程抽象成一个**函数**，那么你眼睛获取的位置信息就是**输入**，你的决策即是**输出**，而我要在这里说的是你获取的这个位置信息并不是最好的输入，设想一下，如果屏幕上打印了你现在距离障碍物的水平和垂直距离并且告诉了你每次跳跃将会相对移动多少距离，你是不是能更加容易的掌握这个游戏。

同理，一个**更好更合理更有关联性的输入**对于机器来说也能降低它的**学习成本**，假如你只给机器一个小鸟无关与障碍物的垂直距离作为输入参数，那么无论你用什么算法，他都永远无法学会玩这个游戏。在FlappyLearning这个仓库中，作者给予机器的输入信息为小鸟距离的障碍物的垂直距离与小鸟距离障碍物的水平距离。

讲到这里其实已经能够解答第一个问题了，机器其实是通过一个**决策函数**来代入**一组输入**然后根据输出结果关联到游戏的具体操作。如果你已经看到了这里你可以发现我的文章中将部分机器行为类比了人类行为，同样在后文中我也会使用类比这个思想去更通俗易懂的讲述其他问题。

### 如何获得一个合适的决策函数

在FlappyLearning这个仓库中作者是使用了**遗传算法**去解决决策函数的构造问题，那么我们就要思考作者为什么选择遗传算法？遗传算法适用的场景有什么？如何在程序中使用遗传算法？在这部分我将围绕着这三个问题来解释。

1. 为什么选择遗传算法

其实在计算机世界中的很多理论都是根据现实生活中的理论映射来的，我们都知道达尔文进化论有一个核心思想叫做物竞天择适者生存，生物在不断进化的路途中总是会淘汰掉不适合的基因，所以最终留下的都是能够在这个世界正常生存下去的基因，如果我们将FlappyBird这个游戏当作一个世界，那么里面的小鸟不断的更新换代进化，保留下优质基因（游戏得分高的），最后总会有一批基因能够适应这个世界（通关这个游戏）。

2. 遗传算法适用的场景



3. 遗传算法的运行流程

* 在知道了遗传算法的概念之后，它的运作流程概括来说应该是这样的：
  * 生成一批随机的基因并加入游戏
  * 保留游戏得分高的优质基因，淘汰游戏得分低的劣质基因，通关杂交变异生成部分新的基因，重复此流程



## 反向传播与遗传算法

### 反向传播

### 遗传算法


## 基于反向传播算法设计FlappyBirdAI

### 流程设计

![](https://resources.chenjianhui.site/2019-09-06-run-flow.png)

1. 玩家通过玩游戏生成游戏数据，这里将采集游戏在每个时间点的**小鸟高度、障碍物高度、小鸟距下一个障碍物的水平距离**作为输入，以这个时间点**玩家的操作**作为输出
2. 将游戏数据统一存储到浏览器的LocalStorage统一管理
3. AI利用玩家产生的游戏数据基于反向传播算法建立决策模型
4. AI进行游戏测试

### 游戏设计

### 游戏展示